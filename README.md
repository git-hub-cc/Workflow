# 表单工作流引擎 (Vue + Spring Boot + Embedded Camunda)

这是一个功能完备、前后端分离的表单与工作流解决方案。它允许用户通过可视化的界面**拖拽生成表单**，并为表单**设计BPMN 2.0审批流程**。整个应用打包成一个独立的单元，后端内置了 Camunda 7 流程引擎和 H2 内存数据库，实现了**零外部依赖**，一键启动。

## 📸 预览

---

## ✨ 核心功能

-   **可视化表单设计器**：通过拖拽方式动态创建和配置表单，支持文本、下拉框、日期等多种组件。
-   **BPMN 2.0 流程设计器**：集成了 `bpmn-js`，允许管理员为表单在线绘制、配置和部署审批流程。
-   **我的待办任务**：清晰的任务列表，让审批人可以方便地处理分配给自己的任务。
-   **流程发起与审批**：普通用户可以填写表单并发起申请，申请将自动进入预设的审批流程。
-   **数据记录与追踪**：可以查看所有表单的提交记录及其当前的流程状态（审批中、已通过、已拒绝）。
-   **管理员后台**：
    -   **用户管理**：集中管理系统中的所有用户及其角色（管理员/普通用户）。
    -   **实例管理**：监控所有正在运行的流程实例，并能在必要时**强制终止**异常流程。
-   **前后端分离架构**：前端使用 Vue 3 + Ant Design，后端使用 Spring Boot，通过 JWT (JSON Web Token) 进行安全认证。
-   **内嵌式引擎**：后端服务已内嵌 Camunda 7 流程引擎和 H2 数据库，无需安装 Docker 或配置外部数据库。

---

## 🏛️ 系统架构

本系统采用经典的前后端分离架构，后端作为一个独立的 Spring Boot 应用，内部集成了所有必要的服务。

```
┌───────────────────────────────────────────┐
│              用户浏览器                  │
└───────────────────────────────────────────┘
│
▼
┌───────────────────────────────────────────┐
│     前端应用 (Vue 3 + Vite)               │
│     运行在: http://localhost:5173         │
└───────────────────────────────────────────┘
│ (通过 /api 代理进行 RESTful API 调用)
▼
┌───────────────────────────────────────────┐
│     后端服务 (Spring Boot)                │
│     运行在: http://localhost:8080         │
│ ┌───────────────────┬───────────────────┐ │
│ │  API & 安全层     │  业务服务层       │ │
│ │ (Controllers)     │ (Form, Workflow)  │ │
│ │ (Spring Security) │                   │ │
│ └───────────────────┴───────────────────┘ │
│                    │                      │
│ ┌───────────────────────────────────────┐ │
│ │      内嵌 Camunda 7 流程引擎          │ │
│ └───────────────────────────────────────┘ │
│                    │                      │
│ ┌───────────────────────────────────────┐ │
│ │      内嵌 H2 内存数据库               │ │
│ └───────────────────────────────────────┘ │
└───────────────────────────────────────────┘
```

---

## 🛠️ 技术栈

<table width="100%">
  <tr>
    <td width="50%" valign="top">
      <h3>后端 (Backend)</h3>
      <ul>
        <li><b>框架:</b> Spring Boot 3.x</li>
        <li><b>安全:</b> Spring Security (JWT)</li>
        <li><b>数据库:</b> JPA (Hibernate) + H2 In-Memory Database</li>
        <li><b>工作流引擎:</b> Camunda 7 (Embedded Engine)</li>
        <li><b>构建工具:</b> Maven</li>
        <li><b>语言:</b> Java 17</li>
      </ul>
    </td>
    <td width="50%" valign="top">
      <h3>前端 (Frontend)</h3>
      <ul>
        <li><b>框架:</b> Vue 3 (Composition API)</li>
        <li><b>构建工具:</b> Vite</li>
        <li><b>状态管理:</b> Pinia</li>
        <li><b>路由:</b> Vue Router</li>
        <li><b>UI 库:</b> Ant Design Vue 4.x</li>
        <li><b>流程图:</b> bpmn-js</li>
      </ul>
    </td>
  </tr>
</table>

---

## 🚀 快速开始

请确保你的开发环境已安装以下软件：

### 环境要求

-   **JDK 17** 或更高版本
-   **Maven 3.8** 或更高版本
-   **Node.js 18** 或更高版本
-   推荐使用 IDE，如 **IntelliJ IDEA** (后端) 和 **VS Code** (前端)

### 安装与配置

1.  **克隆仓库**
    ```bash
    git clone https://github.com/git-hub-cc/Workflow.git
    cd your-repo-name
    ```

2.  **后端配置**
    -   后端代码位于项目根目录。
    -   使用 IntelliJ IDEA 打开项目，它会自动识别为 Maven 项目并下载所有依赖。
    -   无需任何额外配置，`application.properties` 文件已预设使用 H2 内存数据库和内嵌 Camunda 引擎。

3.  **前端配置**
    -   进入前端项目目录：
        ```bash
        cd workflow-ui
        ```
    -   安装依赖：
        ```bash
        npm install
        ```

### 运行应用

你需要**同时启动后端和前端**服务。

1.  **启动后端服务**
    -   在你的 IDE (如 IntelliJ IDEA) 中找到 `src/main/java/club/ppmc/workflow/WorkflowApplication.java` 文件。
    -   右键点击并选择 `Run 'WorkflowApplication.main()'`.
    -   当控制台输出以下信息时，表示后端已成功启动：
        ```
        ==================================================
        应用程序启动成功！
          -> 应用访问地址: http://localhost:8080
          -> H2 数据库控制台: http://localhost:8080/h2-console
          -> Camunda Webapps: http://localhost:8080/camunda/app/
             (使用 'camunda-admin' / 'camunda-admin' 登录)
        ==================================================
        ```

2.  **启动前端服务**
    -   在 `workflow-ui` 目录下，打开一个新的终端。
    -   运行开发服务器：
        ```bash
        npm run dev
        ```
    -   前端应用将运行在 `http://localhost:5173`。

3.  **访问应用**
    -   打开浏览器，访问 **`http://localhost:5173`**。
    -   你将看到应用的登录界面。

---

## 🧑‍💻 使用指南

应用内置了几个演示用户，方便你测试不同角色的功能。

### 演示用户凭据

| 用户ID (登录名) | 密码       | 角色         | 说明             |
| --------------- | ---------- | ------------ | ---------------- |
| `admin`         | `admin`    | **管理员**   | 可以设计表单和流程 |
| `user001`       | `password` | 普通用户     | 员工，可以发起申请 |
| `manager001`    | `password` | 普通用户     | 部门经理，用于审批 |
| `hr001`         | `password` | 普通用户     | 财务总监，用于审批 |

### 端到端测试流程示例

1.  **登录管理员账号** (`admin` / `admin`)。
2.  在首页点击 **“创建新表单”**。
3.  **设计表单**：
    -   输入表单名称，例如“请假申请单”。
    -   从左侧拖拽“单行文本”、“日期选择”、“多行文本”等组件到画布中。
    -   选中画布中的组件，在右侧属性面板配置其标题、是否必填等。
    -   点击右上角 **“保存表单”**。
4.  **设计流程**：
    -   返回首页，找到刚创建的表单，点击 **“设计流程”**。
    -   在流程设计器中，你可以拖拽和连接节点。
    -   **配置审批人**：点击“部门经理审批”节点，在右侧属性面板的 “Assignee” 字段中输入审批人的用户ID（例如 `manager001`）。
    -   点击右上角 **“保存并部署”**。
5.  **发起申请**：
    -   退出登录，使用 **`user001`** / `password` 登录。
    -   在首页找到“请假申请单”，点击 **“发起申请”**。
    -   填写表单内容，然后点击 **“提交申请”**。
6.  **处理任务**：
    -   退出登录，使用审批人账号 **`manager001`** / `password` 登录。
    -   点击右上角的 **“我的待办”** 按钮。
    -   在待办列表中，你应该能看到 `user001` 提交的请假申请。
    -   点击 **“去处理”**，查看申请详情，输入审批意见，然后点击 **“同意”** 或 **“拒绝”**。
7.  **查看结果**：
    -   再次用 `user001` 登录，在首页点击 **“数据记录”**，可以看到申请的状态已经更新为“已通过”或“已拒绝”。

---

## 📂 项目结构

```
.
├── src/main/java/      # Spring Boot 后端 Java 源码
│   ├── config/         #   - Spring Security, JWT, Camunda 配置
│   ├── controller/     #   - REST API 控制器
│   ├── domain/         #   - JPA 实体类
│   ├── dto/            #   - 数据传输对象
│   ├── listener/       #   - Camunda 监听器
│   ├── repository/     #   - JPA Repositories
│   └── service/        #   - 业务逻辑服务
├── src/main/resources/ # Spring Boot 资源文件
│   └── application.properties # 核心配置文件
├── pom.xml             # Maven 项目配置文件
└── workflow-ui/        # Vue 前端项目源码
├── public/         #   - 静态资源
└── src/            #   - Vue 源码
├── api/        #     - API 请求封装
├── assets/     #     - 静态资源
├── components/ #     - 公共组件
├── router/     #     - 路由配置
├── stores/     #     - Pinia 状态管理
└── views/      #     - 页面视图组件
```

---

## 📄 许可证

本项目采用 [MIT License](LICENSE)。 
