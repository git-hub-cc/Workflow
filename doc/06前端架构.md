### 1. 项目概述

本项目是一个基于 Vue 3 的 **表单工作流引擎** 前端界面。它提供了一整套从 **表单设计**、**流程编排** 到 **任务处理** 和 **数据管理** 的闭环功能。用户可以无代码或低代码地创建业务表单，为其绑定可视化的审批流程，并投入使用。

**核心功能模块:**

*   **表单引擎**: 可视化拖拽设计表单，动态渲染表单用于填写和查看。
*   **工作流引擎 (BPMN)**: 集成 `bpmn-js`，允许管理员为表单设计标准的 BPMN 2.0 审批流程。
*   **任务中心**: 用户处理分配给自己的审批任务（我的待办）、跟踪自己发起的申请（我的申请）。
*   **数据管理**: 查看、筛选和管理通过表单提交的数据。
*   **系统管理**: 完善的后台管理功能，包括用户、角色、菜单、组织架构、流程实例监控等。

### 2. 核心技术栈

*   **构建工具**: `Vite` - 提供极速的开发服务器和高效的打包。
*   **前端框架**: `Vue 3` (Composition API) - 现代、高效的 Vue.js 版本。
*   **UI 框架**: `Ant Design Vue 4.x` - 提供了一整套高质量、开箱即用的 UI 组件。
*   **状态管理**: `Pinia` - Vue 官方推荐的状态管理库，轻量、直观且类型友好。
*   **路由**: `Vue Router 4.x` - 官方路由，用于构建单页应用。
*   **HTTP 请求**: `Axios` - 成熟可靠的 HTTP客户端，配合拦截器进行统一处理。
*   **流程图**: `bpmn-js` - 强大的 BPMN 2.0 渲染和建模工具库。
*   **图表**: `ECharts` & `vue-echarts` - 用于仪表盘的数据可视化。
*   **富文本**: `VueQuill` - 集成 Quill.js 的富文本编辑器。

### 3. 项目结构解析

```
src/
├── api/
│   └── index.js           # API 中心：所有后端接口的封装和 Axios 实例配置
├── assets/
│   └── main.css           # 全局基础样式
├── components/
│   ├── AppLayout.vue      # 应用主布局框架 (侧边栏、头部、内容区)
│   ├── FileUploader.vue   # 通用文件上传组件
│   ├── FormPreviewModal.vue # 表单预览模态框
│   └── ...                # 其他可复用的全局组件
├── composables/
│   └── usePaginatedFetch.js # 【重要】可复用的分页逻辑 Hook
├── router/
│   └── index.js           # 【核心】路由配置，包含静态路由和动态路由添加逻辑
├── stores/
│   └── user.js            # 【核心】Pinia store，管理用户会话、菜单和全局权限数据
├── utils/
│   ├── customTranslate.js # bpmn-js 的自定义中文翻译
│   ├── formUtils.js       # 表单相关的工具函数 (如扁平化字段)
│   ├── iconLibrary.js     # Ant Design 图标库，解决 tree-shaking 问题
│   └── ...                # 其他工具函数
├── views/
│   ├── FormBuilder.vue    # 【核心】表单设计器
│   ├── FormViewer.vue     # 【核心】表单渲染/填写器
│   ├── WorkflowDesigner.vue # 【核心】BPMN 流程设计器
│   ├── TaskList.vue       # 任务列表 (我的待办)
│   ├── TaskDetail.vue     # 任务处理页面
│   ├── admin/             # 管理员模块页面
│   │   ├── FormManagement.vue
│   │   └── ...
│   ├── builder-components/ # 表单设计器内部组件 (拖拽项、属性面板等)
│   └── viewer-components/  # 表单渲染器内部组件 (动态渲染各种表单控件)
├── App.vue                # 根组件
└── main.js                # 【核心】应用入口文件
```

### 4. 关键架构设计

#### 4.1. 启动流程与动态路由

这是理解本应用最关键的一点。本应用的导航菜单不是写死在前端的，而是 **由后端根据用户角色动态返回的**。

**启动流程如下：**

```
用户访问页面
     |
     v
main.js: startApp()
     |
     +--> 检查 localStorage 中是否有 token (用户是否已登录?)
     |           |
     |           +-- (是) --> useUserStore().fetchAndSetMenus()
     |           |                 |
     |           |                 v
     |           |           向后端 /menus/my-menus 请求菜单数据
     |           |                 |
     |           |                 v
     |           |           将菜单存入 Pinia store
     |           |                 |
     |           |                 v
     |           |           调用 router/index.js 的 addDynamicRoutes(menus)
     |           |                 |
     |           |                 v
     |           |           根据菜单类型 (FORM_ENTRY, DATA_LIST) 动态添加路由
     |           |
     |           +-- (否) --> 跳过菜单获取
     |
     v
注册 router (此时已包含动态路由)
     |
     v
app.mount('#app')
     |
     v
router.beforeEach 导航守卫生效，根据路由元信息和登录状态进行跳转
```

*   **`main.js`**: 应用的入口，负责在挂载 Vue 实例前，异步初始化 Pinia 并获取动态菜单。
*   **`stores/user.js`**: Pinia 的核心 store，是用户状态（`token`, `currentUser`）和菜单（`menus`）的 **唯一事实来源**。登录成功后会触发 `fetchAndSetMenus`。
*   **`router/index.js`**: 定义了少量 **静态路由** (如登录、主布局、个人中心、固定的管理页面) 和一个 `addDynamicRoutes` 函数。此函数是动态路由的枢纽，它会根据菜单的 `type` 属性，将菜单的 `path` 映射到对应的组件 (`FormViewer.vue` 或 `DataListView.vue`)。

#### 4.2. API 层封装

所有与后端的通信都集中在 `src/api/index.js` 中。

*   **统一部署**: 创建了一个 `axios` 实例，配置了 `baseURL` 和 `timeout`。
*   **请求拦截器**: 在每个请求头中自动附加 `Authorization: Bearer <token>`。
*   **响应拦截器**: 这是应用的 **全局错误处理中心**。它会：
    *   自动解析 `response.data`。
    *   处理 `401 Unauthorized` 错误，自动登出并跳转到登录页。
    *   处理 `400`, `403`, `500` 等常见错误，并使用 `ant-design-vue` 的 `message` 组件向用户显示友好的错误提示。
    *   这极大地简化了业务组件中的代码，你无需在每个 `.vue` 文件中都写 `try...catch` 和错误提示。

#### 4.3. “构建器/渲染器” 核心模式

项目的核心功能（表单和工作流）都遵循此模式。

1.  **表单 (Form)**:
    *   **构建器 (`FormBuilder.vue`)**: 一个复杂的拖拽页面，左侧是组件面板，中间是画布 (`DraggableItem.vue` 递归渲染)，右侧是属性面板 (`PropertiesPanel.vue`)。最终产物是一个描述表单结构的 **JSON Schema**。
    *   **渲染器 (`FormViewer.vue` & `TaskDetail.vue`)**: 接收表单的 JSON Schema，通过 `FormItemRenderer.vue` 组件递归地将 JSON 动态渲染成真实的、可交互的 Ant Design 表单组件。`FormItemRenderer.vue` 是一个巨大的 `v-if/v-else-if` 结构，根据字段的 `type` 属性来决定渲染哪个组件。

2.  **工作流 (Workflow)**:
    *   **构建器 (`WorkflowDesigner.vue`)**: 集成了 `bpmn-js` 库，提供一个可视化的 BPMN 流程设计画布和属性面板。产物是一个 **BPMN XML** 字符串。
    *   **渲染器 (`SubmissionDetail.vue`, `TaskDetail.vue`)**: 通过 API 获取流程历史数据，并使用 `a-timeline` 组件将其 **可视化** 成时间线。

#### 4.4. 可复用逻辑 (Composables)

项目中将一些通用的、有状态的逻辑提取到了 `src/composables` 目录中。

*   **`usePaginatedFetch.js`**: 这是一个 **极其重要** 的 Hook。几乎所有带筛选和分页的表格页面（如登录日志、我的申请、任务列表等）都使用了它。它封装了：
    *   `loading` 状态
    *   `dataSource` (表格数据)
    *   `pagination` (分页对象)
    *   `filterState` (筛选条件)
    *   处理表格变化的 `handleTableChange` 方法
    *   `handleSearch` 和 `handleReset` 方法
    *   这使得表格页面的 `<script>` 部分变得非常简洁和标准化。

### 5. 如何开始开发？

1.  **环境准备**:
    *   确保你的机器上安装了 Node.js (推荐 v18+)。
    *   在项目根目录运行 `npm install` 安装所有依赖。

2.  **启动后端**:
    *   本项目的前端依赖一个运行在 `http://localhost:8080` 的后端服务。请先根据后端项目的说明文档启动后端。
    *   `vite.config.js` 中已配置了 `/api` 的代理，所有前端发出的 `/api/...` 请求都会被转发到 `http://localhost:8080/api/...`。

3.  **启动前端**:
    *   运行 `npm run dev`。
    *   Vite 会启动一个开发服务器，通常在 `http://localhost:5173`。

4.  **登录系统**:
    *   打开浏览器访问开发服务器地址。
    *   `src/views/Login.vue` 文件中提供了可用的演示账户，例如：
        *   **管理员**: `admin` / `admin`
        *   **普通用户**: `user001` / `password`

祝你编码愉快！