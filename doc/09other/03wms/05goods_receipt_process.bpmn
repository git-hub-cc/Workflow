<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.20.0" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.20.0">
  <bpmn:process id="goods_receipt_process" name="货物入库流程" isExecutable="true" camunda:historyTimeToLive="180">
    <bpmn:startEvent id="StartEvent_GoodsReceipt" name="入库员提交申请" camunda:initiator="initiator">
      <bpmn:outgoing>Flow_To_FindManager</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_To_FindManager" sourceRef="StartEvent_GoodsReceipt" targetRef="Activity_FindManager" />
    <bpmn:serviceTask id="Activity_FindManager" name="查找直接上级" camunda:delegateExpression="${findManagerDelegate}">
      <bpmn:extensionElements>
        <camunda:field name="managerLevel">
          <camunda:string>1</camunda:string>
        </camunda:field>
        <camunda:inputOutput>
          <camunda:inputParameter name="userId">${initiator}</camunda:inputParameter>
          <camunda:outputParameter name="assignee">${managerId}</camunda:outputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_To_FindManager</bpmn:incoming>
      <bpmn:outgoing>Flow_To_ManagerApproval</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_To_ManagerApproval" sourceRef="Activity_FindManager" targetRef="Activity_ManagerApproval" />
    <bpmn:userTask id="Activity_ManagerApproval" name="主管审核" camunda:assignee="${assignee}">
      <bpmn:extensionElements>
        <camunda:taskListener delegateExpression="${taskAssignmentListener}" event="create" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_To_ManagerApproval</bpmn:incoming>
      <bpmn:incoming>Flow_From_QC_Return</bpmn:incoming>
      <bpmn:outgoing>Flow_To_ManagerGateway</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="Activity_ArchivePassed" name="归档 (已通过)" camunda:delegateExpression="${archiveProcessDelegate}">
      <bpmn:incoming>Flow_To_ArchivePassed</bpmn:incoming>
      <bpmn:outgoing>Flow_To_EndPassed</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="EndEvent_Passed" name="流程通过结束">
      <bpmn:incoming>Flow_To_EndPassed</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_To_EndPassed" sourceRef="Activity_ArchivePassed" targetRef="EndEvent_Passed" />
    <bpmn:serviceTask id="Activity_ArchiveRejected" name="归档 (已拒绝)" camunda:delegateExpression="${rejectProcessDelegate}">
      <bpmn:incoming>Flow_From_Manager_Reject</bpmn:incoming>
      <bpmn:incoming>Flow_From_QC_Reject</bpmn:incoming>
      <bpmn:outgoing>Flow_To_EndRejected</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="EndEvent_Rejected" name="流程拒绝结束">
      <bpmn:incoming>Flow_To_EndRejected</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_To_EndRejected" sourceRef="Activity_ArchiveRejected" targetRef="EndEvent_Rejected" />
    <bpmn:boundaryEvent id="Event_Overdue" name="超时2分钟升级" attachedToRef="Activity_ManagerApproval">
      <bpmn:outgoing>Flow_1oe7wle</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_1q7z8p4">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT2M</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>
    <bpmn:serviceTask id="Activity_Escalate" name="任务升级给上级" camunda:delegateExpression="${taskEscalationDelegate}">
      <bpmn:incoming>Flow_1oe7wle</bpmn:incoming>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1oe7wle" sourceRef="Event_Overdue" targetRef="Activity_Escalate" />
    <bpmn:exclusiveGateway id="Gateway_Manager_Decision" name="主管审核结果?">
      <bpmn:incoming>Flow_To_ManagerGateway</bpmn:incoming>
      <bpmn:outgoing>Flow_From_Manager_Approve</bpmn:outgoing>
      <bpmn:outgoing>Flow_From_Manager_Reject</bpmn:outgoing>
      <bpmn:outgoing>Flow_From_Manager_Return</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_To_ManagerGateway" sourceRef="Activity_ManagerApproval" targetRef="Gateway_Manager_Decision" />
    <bpmn:sequenceFlow id="Flow_From_Manager_Approve" name="同意" sourceRef="Gateway_Manager_Decision" targetRef="Activity_QCInspection">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${taskOutcome == 'approved'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_From_Manager_Reject" name="拒绝" sourceRef="Gateway_Manager_Decision" targetRef="Activity_ArchiveRejected">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${taskOutcome == 'rejected'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="Activity_Modify" name="修改申请" camunda:assignee="${initiator}">
      <bpmn:incoming>Flow_From_Manager_Return</bpmn:incoming>
      <bpmn:outgoing>Flow_Modify_To_Manager</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_From_Manager_Return" name="打回发起人" sourceRef="Gateway_Manager_Decision" targetRef="Activity_Modify">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${taskOutcome == 'returnToInitiator'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_Modify_To_Manager" sourceRef="Activity_Modify" targetRef="Activity_FindManager" />
    <bpmn:userTask id="Activity_QCInspection" name="QC检验" camunda:candidateGroups="QC_GROUP">
      <bpmn:extensionElements>
        <camunda:taskListener delegateExpression="${taskAssignmentListener}" event="create" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_From_Manager_Approve</bpmn:incoming>
      <bpmn:outgoing>Flow_To_QCGateway</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_To_QCGateway" sourceRef="Activity_QCInspection" targetRef="Gateway_QCCheck" />
    <bpmn:exclusiveGateway id="Gateway_QCCheck" name="质检是否合格?">
      <bpmn:incoming>Flow_To_QCGateway</bpmn:incoming>
      <bpmn:outgoing>Flow_QCPassed</bpmn:outgoing>
      <bpmn:outgoing>Flow_From_QC_Reject</bpmn:outgoing>
      <bpmn:outgoing>Flow_From_QC_Return</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_QCPassed" name="合格" sourceRef="Gateway_QCCheck" targetRef="Activity_PutAwayGoods">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${taskOutcome == 'approved'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_From_QC_Reject" name="不合格" sourceRef="Gateway_QCCheck" targetRef="Activity_ArchiveRejected">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${taskOutcome == 'rejected'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_From_QC_Return" name="打回上一节点" sourceRef="Gateway_QCCheck" targetRef="Activity_ManagerApproval">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${taskOutcome == 'returnToPrevious'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="Activity_PutAwayGoods" name="上架入库" camunda:assignee="${initiator}">
      <bpmn:extensionElements>
        <camunda:taskListener delegateExpression="${taskAssignmentListener}" event="create" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_QCPassed</bpmn:incoming>
      <bpmn:outgoing>Flow_To_ArchivePassed</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_To_ArchivePassed" sourceRef="Activity_PutAwayGoods" targetRef="Activity_ArchivePassed" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="goods_receipt_process">
      <bpmndi:BPMNShape id="StartEvent_GoodsReceipt_di" bpmnElement="StartEvent_GoodsReceipt">
        <dc:Bounds x="179" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="162" y="145" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_FindManager_di" bpmnElement="Activity_FindManager">
        <dc:Bounds x="270" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_ManagerApproval_di" bpmnElement="Activity_ManagerApproval">
        <dc:Bounds x="430" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_ArchivePassed_di" bpmnElement="Activity_ArchivePassed">
        <dc:Bounds x="1270" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Passed_di" bpmnElement="EndEvent_Passed">
        <dc:Bounds x="1432" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1415" y="145" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_ArchiveRejected_di" bpmnElement="Activity_ArchiveRejected">
        <dc:Bounds x="780" y="340" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Rejected_di" bpmnElement="EndEvent_Rejected">
        <dc:Bounds x="942" y="362" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="925" y="405" width="70" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0k0g4f0_di" bpmnElement="Activity_Escalate">
        <dc:Bounds x="350" y="200" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0n76fvy_di" bpmnElement="Gateway_Manager_Decision" isMarkerVisible="true">
        <dc:Bounds x="595" y="95" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="577" y="65" width="87" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_16g603d_di" bpmnElement="Activity_Modify">
        <dc:Bounds x="430" y="340" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_QCInspection_di" bpmnElement="Activity_QCInspection">
        <dc:Bounds x="780" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_QCCheck_di" bpmnElement="Gateway_QCCheck" isMarkerVisible="true">
        <dc:Bounds x="945" y="95" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="929" y="65" width="82" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_PutAwayGoods_di" bpmnElement="Activity_PutAwayGoods">
        <dc:Bounds x="1090" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0f20436_di" bpmnElement="Event_Overdue">
        <dc:Bounds x="462" y="142" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="439" y="185" width="82" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_To_FindManager_di" bpmnElement="Flow_To_FindManager">
        <di:waypoint x="215" y="120" />
        <di:waypoint x="270" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_To_ManagerApproval_di" bpmnElement="Flow_To_ManagerApproval">
        <di:waypoint x="370" y="120" />
        <di:waypoint x="430" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_To_EndPassed_di" bpmnElement="Flow_To_EndPassed">
        <di:waypoint x="1370" y="120" />
        <di:waypoint x="1432" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_To_EndRejected_di" bpmnElement="Flow_To_EndRejected">
        <di:waypoint x="880" y="380" />
        <di:waypoint x="942" y="380" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1oe7wle_di" bpmnElement="Flow_1oe7wle">
        <di:waypoint x="480" y="178" />
        <di:waypoint x="480" y="240" />
        <di:waypoint x="450" y="240" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_084334c_di" bpmnElement="Flow_To_ManagerGateway">
        <di:waypoint x="530" y="120" />
        <di:waypoint x="595" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0n7p023_di" bpmnElement="Flow_From_Manager_Approve">
        <di:waypoint x="645" y="120" />
        <di:waypoint x="780" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="699" y="102" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0nchx1k_di" bpmnElement="Flow_From_Manager_Reject">
        <di:waypoint x="620" y="145" />
        <di:waypoint x="620" y="380" />
        <di:waypoint x="780" y="380" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="631" y="259" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_145j9u5_di" bpmnElement="Flow_From_Manager_Return">
        <di:waypoint x="620" y="145" />
        <di:waypoint x="620" y="280" />
        <di:waypoint x="480" y="280" />
        <di:waypoint x="480" y="340" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="526" y="262" width="54" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1h6g25c_di" bpmnElement="Flow_Modify_To_Manager">
        <di:waypoint x="430" y="380" />
        <di:waypoint x="320" y="380" />
        <di:waypoint x="320" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_To_QCGateway_di" bpmnElement="Flow_To_QCGateway">
        <di:waypoint x="880" y="120" />
        <di:waypoint x="945" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_QCPassed_di" bpmnElement="Flow_QCPassed">
        <di:waypoint x="995" y="120" />
        <di:waypoint x="1090" y="120" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1031" y="102" width="22" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_08y02v8_di" bpmnElement="Flow_From_QC_Reject">
        <di:waypoint x="970" y="145" />
        <di:waypoint x="970" y="270" />
        <di:waypoint x="830" y="270" />
        <di:waypoint x="830" y="340" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="887" y="252" width="34" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0c9v60n_di" bpmnElement="Flow_From_QC_Return">
        <di:waypoint x="970" y="95" />
        <di:waypoint x="970" y="40" />
        <di:waypoint x="480" y="40" />
        <di:waypoint x="480" y="80" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="702" y="22" width="65" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_To_ArchivePassed_di" bpmnElement="Flow_To_ArchivePassed">
        <di:waypoint x="1190" y="120" />
        <di:waypoint x="1270" y="120" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
